
#include "stm32f10x.h"

#include "TFT-7P.h"



const unsigned char  chines_word[   ][32]=   //汉字码
{
0x10,0x01,0x10,0x01,0x10,0x01,0x88,0x7F,0x88,0x40,0x4C,0x20,0x2C,0x04,0x0A,0x04,
0x89,0x14,0x88,0x24,0x48,0x24,0x48,0x44,0x28,0x44,0x08,0x04,0x08,0x05,0x08,0x02,/*"你",0*/

0x08,0x00,0x08,0x3F,0x08,0x20,0x08,0x10,0x3F,0x08,0x24,0x04,0x24,0x04,0xA4,0x7F,
0x24,0x04,0x12,0x04,0x14,0x04,0x08,0x04,0x14,0x04,0x22,0x04,0x21,0x05,0x00,0x02,/*"好",1*/


};




const unsigned char  picture_tab[PIC_NUM]={
/*------------------------------------------------------------------------------
120*120   16位彩色图片，取模方式，水平取模，高位在前
------------------------------------------------------------------------------*/
0x00,0x59,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x96,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x4E,
0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x87,0xC0,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x09,0xC0,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0D,0xC0,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x02,0xFD,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x67,0x79,0xDE,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x98,0x7F,0xD9,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x17,0xFF,0xC7,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xD7,0xFF,0x9E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xC7,0xFF,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xD5,
0xFF,0xF9,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xEB,0xFF,
0xE7,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xCB,0xFF,0xDF,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF7,0x7F,0xC1,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xB6,0x7F,0xFF,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0xDE,0xFF,0xFE,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x70,0xFF,0x0F,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x26,0xCE,0x59,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x0D,0xD7,0x7E,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xA5,0xD3,0xBD,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x01,0x83,0x80,0xE1,0xFB,0x9F,0x32,0xFE,0x77,0x00,0x00,
0x00,0x0D,0xC0,0xDE,0xFF,0xDE,0xEC,0x7E,0x77,0x00,0x00,0x00,
0x0E,0x40,0xBF,0x9D,0x1E,0xFE,0xFE,0x73,0x00,0x00,0x00,0x0F,
0x81,0xFF,0x7F,0xC9,0xDF,0x7E,0x73,0x00,0x00,0x00,0x0F,0x47,
0x73,0xB8,0x0F,0xFB,0xBC,0x00,0x00,0x00,0x00,0x0F,0x47,0xEB,
0x87,0xE1,0xB9,0xFC,0x00,0x00,0x00,0x00,0x0B,0xBE,0xFD,0xFF,
0xFE,0x75,0xF4,0x00,0x00,0x00,0x00,0x01,0xBC,0xD7,0xFF,0xFF,
0xF6,0xDC,0x80,0x00,0x00,0x00,0x00,0x3D,0xD3,0xFF,0xFF,0xFE,
0xDF,0x60,0x00,0x00,0x00,0x00,0x3B,0xFB,0xFF,0xFF,0xFE,0xEF,
0xC0,0x00,0x00,0x00,0x00,0x37,0xB8,0xFF,0xFE,0x1F,0x77,0x00,
0x00,0x00,0x00,0x0C,0x6F,0x7E,0xFF,0xFE,0x7F,0x3B,0xFF,0x00,
0x00,0x00,0x0C,0x6E,0xDE,0xFF,0xFE,0xFF,0xB9,0xFF,0x00,0x00,
0x00,0x0C,0x5D,0xFE,0xFF,0xDF,0x7F,0xDD,0xFF,0x00,0x00,0x00,
0x01,0x9B,0xEF,0x77,0xED,0xDE,0x4E,0xFE,0x00,0x00,0x00,0x0F,
0xBB,0xFF,0x8D,0xE3,0xFF,0xEE,0xFF,0x00,0x00,0x00,0x0F,0xB5,
0xFF,0xFF,0xFF,0xDF,0xC7,0x7F,0x00,0x00,0x00,0x0F,0xF6,0x03,
0xFF,0xE0,0x3C,0xE7,0x7F,0x80,0x00,0x00,0x0F,0xFD,0xFF,0xF7,
0xFF,0xDF,0xF7,0x4F,0x00,0x00,0x00,0x0F,0x7B,0xFE,0x92,0x5F,
0xFE,0x77,0x3F,0x00,0x00,0x00,0x0C,0x6F,0xFF,0xED,0xFF,0xFF,
0xFB,0xFD,0x00,0x00,0x00,0x1F,0x7F,0xC1,0x7F,0xB0,0x3F,0xF7,
0xFE,0x00,0x00,0x00,0x1B,0xFF,0xDF,0xFF,0xBF,0xFF,0xF7,0xCF,
0x00,0x00,0x00,0x0F,0xFF,0xFF,0xFF,0x6F,0xFF,0xF3,0xE7,0x00,
0x00,0x00,0x18,0xF9,0xFF,0xC9,0xFF,0xF7,0xF3,0xFD,0x00,0x00,
0x00,0x0F,0xFF,0xBF,0xFD,0xFB,0xFF,0xFB,0xFD,0x00,0x00,0x00,
0x17,0xF7,0xFC,0xEE,0xFF,0xFF,0xEF,0x1F,0x00,0x00,0x00,0x0E,
0x76,0xF7,0xBF,0x7D,0xFF,0xB7,0x67,0x00,0x00,0x00,0x08,0xBB,
0xEF,0xFF,0xAB,0xFF,0xB7,0x7D,0x00,0x00,0x00,0x0F,0xBD,0xDF,
0xFF,0xDF,0xFF,0xB7,0x4F,0x80,0x00,0x00,0x0D,0xDF,0xBF,0xFF,
0xDF,0xBF,0xF6,0x7D,0xCF,0x30,0x00,0x0D,0xEF,0x3F,0xFF,0xDF,
0xFF,0xD7,0x79,0xCF,0x30,0x00,0x0D,0xF7,0x3F,0xFF,0xBD,0xD9,
0xA7,0x79,0xCF,0x30,0x00,0x0D,0xF6,0xFF,0xFF,0xE7,0x9B,0xFB,
0x59,0xCF,0x30,0x00,0x0D,0xEE,0x8F,0xCF,0xF7,0xEE,0x7B,0xDB,
0x00,0x00,0x00,0x09,0xEE,0xFF,0xDD,0xF7,0xA5,0xDB,0xBB,0x00,
0x00,0x00,0x03,0xFC,0xFF,0xDF,0xF7,0xBD,0xC7,0xB8,0x00,0x00,
0x00,0x07,0x9D,0xFF,0xDF,0xE7,0xD9,0xCF,0xD2,0x6D,0x00,0x00,
0x0E,0xFB,0x81,0xDF,0xFE,0xDC,0xDF,0xDD,0xCE,0xC0,0x00,0x0A,
0xBB,0x87,0xDD,0xFF,0xDC,0xDF,0xCE,0x77,0xE0,0x00,0x07,0x77,
0xFF,0xF3,0xF7,0xDD,0xDF,0xE7,0xBD,0xE0,0x00,0x0D,0x78,0xFE,
0x7F,0xF9,0xEF,0xDF,0xEF,0xFF,0xF0,0x00,0x07,0x7E,0xF1,0xFF,
0xF9,0xBF,0x9F,0xEF,0xC1,0x20,0x00,0x0F,0x7E,0x0F,0xFF,0xFF,
0xF7,0x1F,0xEF,0x9F,0xF0,0x00,0x0E,0xFF,0x7F,0xFF,0xFF,0xF8,
0x6F,0xE6,0x7F,0x80,0x00,0x0E,0xFF,0x16,0x63,0x06,0x02,0x17,
0xFD,0xFF,0x90,0x00,0x0E,0xFF,0x00,0x00,0x00,0x00,0x08,0x73,
0xFF,0xD8,0x00,0x0D,0xFF,0x00,0x00,0x00,0x00,0x0C,0xF7,0xFF,
0xD0,0x00,0x0D,0xFF,0x00,0x00,0x00,0x00,0x0D,0xFF,0xFF,0xD0,
0x00,0x0D,0xFF,0x00,0x00,0x00,0x00,0x0B,0xFF,0xFF,0xD0,0x00,
0x1D,0xFF,0x00,0x00,0x00,0x00,0x0B,0xFB,0xFF,0xB8,0x00,0x1D,
0xFF,0x00,0x00,0x00,0x00,0x1B,0xF1,0xDF,0xA0,0x00,0x1D,0xFE,
0x00,0x00,0x00,0x00,0x1B,0xF0,0x3F,0x70,0x00,0x0D,0xFE,0x00,
0x00,0x00,0x00,0x05,0xF7,0xFC,0xF0,0x00,0x0D,0xFD,0x80,0x00,
0x00,0x00,0x1F,0xFF,0xF2,0xF0,0x00,0x0D,0xFB,0x00,0x00,0x00,
0x00,0x1E,0x7F,0xC4,0xF0,0x00,0x0F,0xC7,0x00,0x00,0x00,0x00,
0x1F,0x70,0x18,0x80,0x00,0x06,0xEF,0x00,0x00,0x00,0x00,0x0E,
0xEF,0xDC,0x20,0x00,0x0E,0xEF,0x00,0x00,0x00,0x00,0x1E,0xEF,
0xFF,0xF0,0x00,0x0F,0x77,0x00,0x06,0xDA,0x00,0x1D,0xCF,0xFF,
0xF0,0x00,0x03,0x39,0xD0,0x0F,0xFF,0xFF,0xEB,0xC8,0x00,0x00,
0x00,0x03,0xBE,0x72,0x0F,0xFF,0xBD,0xE7,0xA3,0x00,0x00,0x00,
0x01,0xCF,0x8F,0xF3,0x4F,0x4F,0x1F,0x63,0x00,0x00,0x00,0x09,
0xE7,0xE1,0xFF,0x7F,0xF8,0x7E,0xF3,0x00,0x00,0x00,0x0C,0x3B,
0xFE,0x00,0x00,0x03,0xF9,0xC0,0x00,0x00,0x00,0x0E,0x3E,0xFF,
0xFF,0x83,0xFF,0xE3,0xC0,0x00,0x00,0x00,0x0E,0x3F,0x9F,0xFF,
0xFF,0xFF,0x9B,0xC0,0x00,0x00,0x00,0x0E,0x05,0x40,0xFF,0xFF,
0xFC,0x7F,0xC0,0x00,0x00,0x00,0x0E,0x00,0x00,0x00,0x00,0x00,
0x6F,0x80,0x00,0x00,0x00,0x08,0x00,0xFF,0xFE,0xC1,0xFF,0xFF,
0x80,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0x80,
0x00,0x00,0x00,0x00,0x00,0xFF,0xE8,0xCE,0xFF,0xFF,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x06,0xD9,0xFF,0xF0,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0xFB,0xBA,0x00,0x0E,0x07,0x00,0x00,0x00,
0x00,0x00,0xFF,0xFF,0xFF,0x00,0x0E,0x07,0x00,0x00,/*"E:\1.bmp",0*/


};




void IO_init(void)
{
	RCC->APB2ENR|=1<<3;    //使能PORTB时钟 
	GPIOB->CRL&=0X000FFFFF;				//将B567口配置为通用推挽输出,最大50MH
	GPIOB->CRL|=0X33300000;				
	GPIOB->CRH&=0XFFFFFF00;				//将B89口配置为通用推挽输出,最大50MH
	GPIOB->CRH|=0X00000033;
	GPIOB->ODR=0XFFFF;
}

/*************SPI配置函数*******************
SCL空闲时低电平，第一个上升沿采样
模拟SPI
******************************************/

/**************************SPI模块发送函数************************************************

 *************************************************************************/
void SPI_SendByte(unsigned  char byte)				//向液晶屏写一个8位数据
{
  
  unsigned char counter;
	SPI_WR_0;
   
  for(counter=0;counter<8;counter++)
  { 
    SPI_SCK_0;	  
    if((byte&0x80)==0)
    {
      SPI_SDA_0;
    }
    else SPI_SDA_1;
    byte=byte<<1;	
    SPI_SCK_1;			
  }
  
  
		SPI_WR_1;				//上拉WR确定数据输入
	SPI_SCK_0;
}

void TFT_SEND_CMD(unsigned char o_command)
  {
    SPI_DC_0;
    //SPI_WR_0;
    SPI_SendByte(o_command);
   // SPI_WR_1;
   
    //SPI_DC_1;
  }
  //向液晶屏写一个8位数据
void TFT_SEND_DATA(unsigned  char o_data)
  { 
    SPI_DC_1;
   // SPI_WR_0;
    SPI_SendByte(o_data);
   // SPI_WR_1;
    
   }
void TFT_clear(void)
  {
    unsigned int ROW,column;
  TFT_SEND_CMD(0x2a);     //Column address set
  TFT_SEND_DATA(0x00);    //start column
  TFT_SEND_DATA(0x00); 
  TFT_SEND_DATA(0x00);    //end column
  TFT_SEND_DATA(0xF0);

  TFT_SEND_CMD(0x2b);     //Row address set
  TFT_SEND_DATA(0x00);    //start row
  TFT_SEND_DATA(0x00); 
  TFT_SEND_DATA(0x01);    //end row
  TFT_SEND_DATA(0x40);
    TFT_SEND_CMD(0x2C);     //Memory write
    for(ROW=0;ROW<TFT_LINE_NUMBER;ROW++)             //ROW loop
      { 
    
          for(column=0;column<TFT_COLUMN_NUMBER;column++)  //column loop
            {
              
				TFT_SEND_DATA(0xFF);
				TFT_SEND_DATA(0xFF);
            }
      }
  }
void TFT_full(unsigned int color)
  {
    unsigned int ROW,column;
    TFT_SEND_CMD(0x2a);     //Column address set
  TFT_SEND_DATA(0x00);    //start column
  TFT_SEND_DATA(0x00); 
  TFT_SEND_DATA(0x00);    //end column
  TFT_SEND_DATA(0xF0);

  TFT_SEND_CMD(0x2b);     //Row address set
  TFT_SEND_DATA(0x00);    //start row
  TFT_SEND_DATA(0x00); 
  TFT_SEND_DATA(0x01);    //end row
  TFT_SEND_DATA(0x40);
    TFT_SEND_CMD(0x2C);     //Memory write
    for(ROW=0;ROW<TFT_LINE_NUMBER;ROW++)             //ROW loop
      { 
    
  for(column=0;column<TFT_COLUMN_NUMBER ;column++) //column loop
          {

			TFT_SEND_DATA(color>>8);
			  TFT_SEND_DATA(color);
          }
      }
  }

void TFT_init(void)        ////ST7789
  {
	SPI_SCK_1;			//特别注意！！	  
  SPI_RST_0;
	Delay_ms(10);
	SPI_RST_1;
	Delay_ms(120);

	TFT_SEND_CMD(0x01);//Software Reset
	Delay_ms(120);

    TFT_SEND_CMD(0x11); 			//Sleep Out
	Delay_ms(120);               //DELAY120ms
	 	  //-----------------------ST7789V Frame rate setting-----------------//
//************************************************
	TFT_SEND_CMD(0x3A);        //65k mode
	TFT_SEND_DATA(0x05);
	TFT_SEND_CMD(0xC5); 		//VCOM
	TFT_SEND_DATA(0x1A);
	TFT_SEND_CMD(0x36);                 // 屏幕显示方向设置
	TFT_SEND_DATA(0x00);
	//-------------ST7789V Frame rate setting-----------//
	TFT_SEND_CMD(0xb2);		//Porch Setting
	TFT_SEND_DATA(0x05);
	TFT_SEND_DATA(0x05);
	TFT_SEND_DATA(0x00);
	TFT_SEND_DATA(0x33);
	TFT_SEND_DATA(0x33);

	TFT_SEND_CMD(0xb7);			//Gate Control
	TFT_SEND_DATA(0x05);			//12.2v   -10.43v
	//--------------ST7789V Power setting---------------//
	TFT_SEND_CMD(0xBB);//VCOM
	TFT_SEND_DATA(0x3F);

	TFT_SEND_CMD(0xC0); //Power control
	TFT_SEND_DATA(0x2c);

	TFT_SEND_CMD(0xC2);		//VDV and VRH Command Enable
	TFT_SEND_DATA(0x01);

	TFT_SEND_CMD(0xC3);			//VRH Set
	TFT_SEND_DATA(0x0F);		//4.3+( vcom+vcom offset+vdv)

	TFT_SEND_CMD(0xC4);			//VDV Set
	TFT_SEND_DATA(0x20);				//0v

	TFT_SEND_CMD(0xC6);				//Frame Rate Control in Normal Mode
	TFT_SEND_DATA(0X01);			//111Hz

	TFT_SEND_CMD(0xd0);				//Power Control 1
	TFT_SEND_DATA(0xa4);
	TFT_SEND_DATA(0xa1);

	TFT_SEND_CMD(0xE8);				//Power Control 1
	TFT_SEND_DATA(0x03);

	TFT_SEND_CMD(0xE9);				//Equalize time control
	TFT_SEND_DATA(0x09);
	TFT_SEND_DATA(0x09);
	TFT_SEND_DATA(0x08);
	//---------------ST7789V gamma setting-------------//
	TFT_SEND_CMD(0xE0); //Set Gamma
	TFT_SEND_DATA(0xD0);
	TFT_SEND_DATA(0x05);
	TFT_SEND_DATA(0x09);
	TFT_SEND_DATA(0x09);
	TFT_SEND_DATA(0x08);
	TFT_SEND_DATA(0x14);
	TFT_SEND_DATA(0x28);
	TFT_SEND_DATA(0x33);
	TFT_SEND_DATA(0x3F);
	TFT_SEND_DATA(0x07);
	TFT_SEND_DATA(0x13);
	TFT_SEND_DATA(0x14);
	TFT_SEND_DATA(0x28);
	TFT_SEND_DATA(0x30);

	TFT_SEND_CMD(0XE1); //Set Gamma
	TFT_SEND_DATA(0xD0);
	TFT_SEND_DATA(0x05);
	TFT_SEND_DATA(0x09);
	TFT_SEND_DATA(0x09);
	TFT_SEND_DATA(0x08);
	TFT_SEND_DATA(0x03);
	TFT_SEND_DATA(0x24);
	TFT_SEND_DATA(0x32);
	TFT_SEND_DATA(0x32);
	TFT_SEND_DATA(0x3B);
	TFT_SEND_DATA(0x14);
	TFT_SEND_DATA(0x13);
	TFT_SEND_DATA(0x28);
	TFT_SEND_DATA(0x2F);

	TFT_SEND_CMD(0x20); 		//反显
	Delay_ms(120); 
	TFT_SEND_CMD(0x29);         //开启显示
  }


void display_char16_16(unsigned int x,unsigned int y,unsigned long color,unsigned char word_serial_number)
{
   unsigned int column;
  unsigned char tm=0,temp=0,xxx=0;

   TFT_SEND_CMD(0x2a);    //Column address set
  TFT_SEND_DATA(x>>8);    //start column
  TFT_SEND_DATA(x);
  x=x+15;
  TFT_SEND_DATA(x>>8);    //end column
  TFT_SEND_DATA(x);

  TFT_SEND_CMD(0x2b);     //Row address set
  TFT_SEND_DATA(y>>8);    //start row
  TFT_SEND_DATA(y); 
  y=y+15;
  TFT_SEND_DATA(y>>8);    //end row
  TFT_SEND_DATA(y);
    TFT_SEND_CMD(0x2C);     //Memory write
    
    
  for(column=0;column<32;column++)  //column loop
          {
        temp=chines_word[  word_serial_number ][xxx];
        for(tm=0;tm<8;tm++)
        {
        if(temp&0x01)
          {
          TFT_SEND_DATA(color>>8);
          TFT_SEND_DATA(color);
          }
        else 
          {
          TFT_SEND_DATA(0XFF);
          TFT_SEND_DATA(0XFF);
          }
          temp>>=1;
        }
        xxx++;
          
      }
}

void Picture_Display(const unsigned char *ptr_pic)
{
    unsigned long  number;
	TFT_SEND_CMD(0x2a); 		//Column address set
	TFT_SEND_DATA(0x00); 		//start column
	TFT_SEND_DATA(0x00); 
	TFT_SEND_DATA(0x00);		//end column
	TFT_SEND_DATA(0x77);

	TFT_SEND_CMD(0x2b); 		//Row address set
	TFT_SEND_DATA(0x00); 		//start row
	TFT_SEND_DATA(0x00); 
	TFT_SEND_DATA(0x00);		//end row
	TFT_SEND_DATA(0x78);
	TFT_SEND_CMD(0x2C);			//Memory write
	  
	for(number=0;number<PIC_NUM;number++)	
          {
//            data=*ptr_pic++;
//            data=~data;
            TFT_SEND_DATA(*ptr_pic++);
	
			
          }
  }

